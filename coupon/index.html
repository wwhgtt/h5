<!DOCTYPE>
<html>
	<head>
		<title></title>
		<meta charset="utf-8"/>
		<meta Content-Type="application/x-www-form-urlencoded" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
		<link rel="stylesheet" type="text/css" href="./css/style.css">
		<script src="./js/lib/zetpo.min.js"></script>
		<script src="./js/script/config.js"></script>
	</head>
	<body>
		<div class="container">
			<img src="./img/logonew.png" class="logo">
			<div class="content">
				<h1>益驾学车发优惠券了</h1>
				<h2 class="show">新用户获取100元优惠券</h2>
				<h2 class="getName show"><span>获取</span><span class="name" style="color:white"></span><span>提供的优惠学车机会</span></h2>
				<h2 class="hidden">益驾小伙伴,终于等到你</h2>
				<h2 class="hidden">使用邀请码付费学车</h2>
				<h2 class="hidden"><span class="name" style="color:white"></span><span>也将获得100元</span></h2>
			</div>
			<img src="./img/quan2.png" class="hidden normalPng">
			<div class="contents hidden">
				<h2 class="hidden">学车券已存入你的帐号</h2>
				<h2 class="hidden phoneNum"></h2>
			</div>
			<div class="main show">
				<img src="./img/quan.png" class="quanPng">
				<div class="clear"></div>
				<div class="phoneInput">
					<input type="text" placeholder="请输入您的手机号" class="phone" >
					<button type="button" class="phoneButton">获取验证码</button> 
				</div>
				<small class="smallWord">请输入正确的手机号</small>
				<div class="phoneInput">
					<input type="text" class="code" placeholder="请输入您的验证码" style="width:100%;text-align:left;padding-left:20px">
				</div>
				<div class="getQuan">
					<button>领取学车优惠券</button>
				</div>
			</div>
		</div>
	</body>
</html>
<script type="text/javascript">
	$(document).ready(function(){
		var href=location.href;
		var inviteCode=href.replace(/^.+?inviteCode\=/,'');
		$.get(BASE_URL+"/basic/common/getUserNameByInviteCode",{
			inviteCode:inviteCode
		},function(result){
			if(result && result.name){
				var name=result.name;
				$(".name").html(name);
				$(".name").css("color","white")
			}else{
				alert("获取优惠券失败")
			}
		})
		// var phone=$(".phone").val();
		$(".phoneButton").on("click",function(){
			var phoneNumber=$(".phoneInput input").val();
			if(!phoneNumber.match(/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/)){
				$(".smallWord").css("display","block");
				return false;
			}else{
				$(".phoneNum").html(phoneNumber);
				function jump(countDown){
	                window.setTimeout(function(){
	                    countDown--;
	                    if(countDown > 0){
	                    	$(".phoneButton").attr("disabled","true");
	                        $(".phoneButton").html(countDown +'秒后'+ '重发');
	                        jump(countDown);
	                    }else{
	                        $(".phoneButton").html('发送验证码');
	                        $(".phoneButton").removeAttr("disabled");
	                    }
	                },1000);
	            }
	            jump(60);
				$(".smallWord").css("display","none");
				$.get(BASE_URL+"/basic/register/code",{
					phone:phoneNumber
				},function(result){
					if(result && result.success == true){
						//改变button的html
					}else{
						alert("发送失败")
					}
				})
			}
		})
		$(".getQuan").on("click",function(){
			var code=$(".code").val();
			if(code == ""){
				alert("请输入您的验证码")
			}else{
				$.get(BASE_URL+"/basic/register/invitePrivilege",{
					code:code,
					inviteCode:inviteCode
				},function(result){
					if(result && result.success == true){
						$(".hidden").css("display","block");
						$(".show").css("display","none")
					}else if(result && result.success == false){
						var errorInfo=result.errorInfo;
						alert(errorInfo);
						location.reload(); 
					}
				})
			}
		})
	})
</script>
