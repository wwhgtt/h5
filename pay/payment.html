<!DOCTYPE>
<html>
	<head>
		<title></title>
		<meta charset="utf-8"/>
		<meta Content-Type="application/x-www-form-urlencoded" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no"/>
		<link rel="stylesheet" type="text/css" href="./css/style.css">
		<script src="./js/lib/zetpo.min.js"></script>
		<script src="./js/script/config.js"></script>
		<script src="./js/lib/pingpp_pay.js"></script>
	</head>
	<body>
		<h2 class="assignment" style="margin-top:10%">个人信息</h2>
		<div class="content" style="margin-top:8%;height:73%">
			<img src="./img/qiche.png" class="qiche" >
			<div class="clear"></div>
			<form class="forPay">
				<label>姓名:</label>
				<input type="text" placeholder="请输入您的姓名" class="nameInput">
				<div class="clear"></div>
				<label style="margin-top:5%;">电话:</label>
				<input type="text" placeholder ="请输入您的电话" style="margin-top:5%;" class="phoneInput">
			</form>
			<div class="next_step">
				<a><button type="submit" class="payment" id="goPay" style="margin-top:10%;background-color:#4ab1ff">去支付</button></a>
			</div>
		</div>
	</body>
</html>
<script type="text/javascript">
	$(".phoneInput").blur(function(){
		if (!$(this).val().match(/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/)) {
			var html="<small style='color:red;z-index:20;margin-top:10px'>请输入正确的手机号</small>";
			$(html).appendTo(".forPay");
			// $(this).focus();
			return false;
		}	 
	})
	$(".payment").on("click",function(){
		$(".payment").attr("disabled","true");
		var name=$(".nameInput").val(),
			phone=$(".phoneInput").val(),
			subject="益驾科技",
			channel="alipay_wap",
			amount="1",
			body="报名定金",
			success_url="http://192.168.31.132:85/complate.html";
		if(name !== "" && phone !== "" && $(".phoneInput").val().match(/^(((13[0-9]{1})|(15[0-9]{1})|(18[0-9]{1})|(17[0-9]{1})|(14[0-9]{1}))+\d{8})$/)){
 			$.post(BASE_URL+"/enroll/enroll/enrolldownpay.do",{
 				enrollname:name,
 				phonenum :phone,
 				channel : channel,
            	amount: amount,
            	subject:subject,
            	body:body,
            	success_url:success_url 
 			},function(result){
 				var charge=result.charge;
 				var enrollid=result.enrollid;
 				localStorage.setItem("enrollid",enrollid);
 				pingpp.createPayment(charge,function(result, error){
				    //只能处理微信支付的返回结果
				});
 			})
		}else{
			alert("请输入正确的名字或电话");
		}
	})
</script>